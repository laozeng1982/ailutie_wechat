<!--pages/plan/user_define/preview_plan.wxml-->

<view class='thisContainer'>
    <view class='graySpaceSmall'></view>

    <!-- 默认日历列表 -->
    <view class='dateTopArea' wx:if="{{!showPlanDetail}}">

        <view class="dateControl">

            <view class="header">
                <picker mode="date" value="{{selectedDate}}" start="2015-09-01" end="2099-12-31" bindchange="onSelectMonthYear">
                    <view class="picker">

                        <view class='picker-text' style='width:120rpx;'>
                            <text>{{curYear}}</text>
                        </view>年

                        <view class='picker-text' style='width:60rpx;'>
                            <text>{{curMonth}}</text>
                        </view>月

                    </view>
                </picker>
                <view class='thisMounthContanier' bindtap="onToThisMounth">
                    <view class="{{curMonth!==todayMonth || curYear!==todayYear?'thisMounth':'not_thisMounth'}}">本月</view>
                </view>
            </view>
        </view>

        <swiper style='width:100%; height:600rpx' indicator-dots="{{false}}" vertical="true" circular="{{true}}" autoplay="{{false}}" duration="{{duration}}" bindchange="onVerticalSwiperChange">
            <block wx:for="{{calendars}}" wx:key="{{index}}">
                <swiper-item id="{{item}}">
                    <!-- 正常的日历面板 -->
                    <view class="calendar_panel">
                        <!-- 日历头 -->
                        <view class="calendar_box">
                            <view class="calendar_box_header">
                                <view class="weekday_label_header">
                                    <text class="redcolor">日</text>
                                </view>
                                <view class="weekday_label_header">一</view>
                                <view class="weekday_label_header">二</view>
                                <view class="weekday_label_header">三</view>
                                <view class="weekday_label_header">四</view>
                                <view class="weekday_label_header">五</view>
                                <view class="weekday_label_header">
                                    <text class="redcolor">六</text>
                                </view>
                            </view>
                        </view>

                        <!-- 日历中每天的显示 -->
                        <view class="calendar_box" wx:for="{{dateList}}" wx:key="{{index}}" wx:for-item="week">
                            <view class="weekday_label_days" wx:for="{{week}}" wx:key="{{index}}">

                                <view class="{{item.value==selectedDate?'active_date_overlay':''}}">
                                    <view class="{{!item.inThisMonth?'not_in_this_month_date':''}} " bindtap="onDateSelected" data-date="{{item}}">{{item.date}}</view>

                                    <!-- 日历每天下段标注 -->
                                    <view class='calendar-marker'>
                                        <!-- 有计划记录的日期 -->
                                        <view wx:for-item="{{dateListWithPlan}}" class="{{item.hasPlan?'image_overlay':''}}">
                                            <image class='image_overlay' src="{{item.hasPlan?'../../image/calendar_64px.png':''}}"></image>
                                        </view>
                                    </view>
                                </view>

                            </view>
                        </view>
                    </view>
                </swiper-item>
            </block>
        </swiper>
    </view>

    <!-- 当选中某一天是显示具体的计划 -->
    <view class='dateTopArea' wx:if="{{showPlanDetail}}">

        <view class="dateControl" bindtap='onCalendarHeader'>

            <view class="header">
                <picker mode="date" value="{{selectedDate}}" start="2015-09-01" end="2099-12-31" bindchange="onSelectMonthYear">
                    <view class="picker">

                        <view class='picker-text' style='width:120rpx;'>
                            <text>{{curYear}}</text>
                        </view>年

                        <view class='picker-text' style='width:60rpx;'>
                            <text>{{curMonth}}</text>
                        </view>月

                    </view>
                </picker>
                <view class='thisMounthContanier' bindtap="onToThisMounth">
                    <view class="{{curMonth!==todayMonth || curYear!==todayYear?'thisMounth':'not_thisMounth'}}">本月</view>
                </view>
            </view>
        </view>

        <!-- 正常的日历面板 -->
        <view class="calendar_panel">
            <!-- 日历头 -->
            <view class="calendar_box" bindtap='onCalendarHeader'>
                <view class="calendar_box_header">
                    <view class="weekday_label_header">
                        <text class="redcolor">日</text>
                    </view>
                    <view class="weekday_label_header">一</view>
                    <view class="weekday_label_header">二</view>
                    <view class="weekday_label_header">三</view>
                    <view class="weekday_label_header">四</view>
                    <view class="weekday_label_header">五</view>
                    <view class="weekday_label_header">
                        <text class="redcolor">六</text>
                    </view>
                </view>
            </view>

            <!-- 日历中每天的显示 -->
            <!-- 只循环当前选中这一周 -->
            <view class="calendar_box">
                <view class="weekday_label_days" wx:for="{{selectedWeek}}" wx:key="{{index}}">

                    <view class="{{item.value==selectedDate?'active_date_overlay':''}}">
                        <view class="{{!item.inThisMonth?'not_in_this_month_date':''}} " bindtap="onDateSelected" data-date="{{item}}">{{item.date}}</view>

                        <!-- 日历每天下段标注 -->
                        <view class='calendar-marker'>
                            <!-- 有计划记录的日期 -->
                            <view wx:for-item="{{dateListWithPlan}}" class="{{item.hasPlan?'image_overlay':''}}">
                                <image class='image_overlay' src="{{item.hasPlan?'../../image/calendar_64px.png':''}}"></image>
                            </view>
                        </view>
                    </view>
                </view>
            </view>
        </view>

        <view class='graySpaceSmall'></view>

        <scroll-view class="scrollviewVertical" scroll-y="true">
            <!--  循环每个部位 -->
            <view id="{{item.actionName}}" class='actionContainer' wx:for="{{item.actionList}}" wx:key="{{index}}" bindtap='onActionSelected'>
                <!-- 循环每个部位的动作 -->
                <view id="{{item.actionName}}" class='actionContainer' wx:for="{{item.actionList}}" wx:key="{{index}}" bindtap='onActionSelected'>
                    <!-- 图片占位 -->
                    <view class='imageBig'></view>
                    <!-- <image src='../../image/pulse_64px.png'></image> -->

                    <view class='actionItem'>
                        <view class='header'>
                            <view>{{item.actionName}}</view>
                        </view>
                        <picker wx:if="{{item.actionMeasurement !== ''}}" id="{{item.actionId}}" mode="multiSelector" bindchange="onNumberChange" value="{{multiActionNoIndex}}" range="{{actionNoMultiArray}}">
                            <view class="pickerContainer">
                                <view class="pickerItem">{{item.groupData.length}} </view>
                                <view class="pickerItem">组</view>
                                <view class="pickerItem">{{item.groupData[0].quantity}}</view>
                                <view class="pickerItem">{{item.actionGpMeasurement}}</view>
                                <view class="pickerItem">{{item.groupData[0].weight}}</view>
                                <view class="pickerItem">{{item.groupData[0].uom}}</view>
                            </view>
                        </picker>
                    </view>
                </view>
            </view>
        </scroll-view>

    </view>

    <!-- 这是Toast -->
    <include src="../../ui/toast/warn_toast.wxml" />

    <view class='graySpaceSmall'></view>

    <view class='footArea'>
        <button class='nextBtn' type='primary' bindtap='onNext'> 确定并保存 </button>
    </view>

</view>